

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>meshmagick.hydrostatics &mdash; Meshmagick User&#39;s Guide 3.2 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Meshmagick User's Guide
          

          
          </a>

          
            
            
              <div class="version">
                3.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/install.html">Installation Instructions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../command_line/index.html">Meshmagick’s Command Line Interface</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Meshmagick Package’s modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Meshmagick User's Guide</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>meshmagick.hydrostatics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for meshmagick.hydrostatics</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#  -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;This module allows to perform hydrostatics computations on meshes&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">.mesh_clipper</span> <span class="kn">import</span> <span class="n">MeshClipper</span>
<span class="kn">from</span> <span class="nn">.rotations</span> <span class="kn">import</span> <span class="n">cardan_to_rotmat</span><span class="p">,</span> <span class="n">rotmat_to_cardan</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">radians</span>

<span class="kn">from</span> <span class="nn">meshmagick</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Francois Rongere&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2014-2015, Ecole Centrale de Nantes / D-ICE ENGINEERING&quot;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="s2">&quot;Francois Rongere&quot;</span>
<span class="n">__licence__</span> <span class="o">=</span> <span class="s2">&quot;GPLv3&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Francois Rongere&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;Francois.Rongere@dice-engineering.com&quot;</span>
<span class="n">__status__</span> <span class="o">=</span> <span class="s2">&quot;Development&quot;</span>



<div class="viewcode-block" id="compute_hydrostatics"><a class="viewcode-back" href="../../api/meshmagick.hydrostatics.html#meshmagick.hydrostatics.compute_hydrostatics">[docs]</a><span class="k">def</span> <span class="nf">compute_hydrostatics</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">rotmat_corr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">z_corr</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                         <span class="n">at_cog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lpp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orig_at_ap</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">wmesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">wmesh</span><span class="o">.</span><span class="n">rotate_matrix</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">)</span>
    <span class="n">wmesh</span><span class="o">.</span><span class="n">translate_z</span><span class="p">(</span><span class="n">z_corr</span><span class="p">)</span>

    <span class="n">wcog</span> <span class="o">=</span> <span class="n">cog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">wcog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">,</span> <span class="n">wcog</span><span class="p">)</span>
    <span class="n">wcog</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">z_corr</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">clipper</span> <span class="o">=</span> <span class="n">MeshClipper</span><span class="p">(</span><span class="n">wmesh</span><span class="p">,</span> <span class="n">assert_closed_boundaries</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">err</span>

    <span class="n">cmesh</span> <span class="o">=</span> <span class="n">clipper</span><span class="o">.</span><span class="n">clipped_mesh</span>

    <span class="n">wet_surface_area</span> <span class="o">=</span> <span class="n">cmesh</span><span class="o">.</span><span class="n">faces_areas</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">inertia</span> <span class="o">=</span> <span class="n">cmesh</span><span class="o">.</span><span class="n">eval_plain_mesh_inertias</span><span class="p">(</span><span class="n">rho_water</span><span class="p">)</span>

    <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">zb</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">gravity_center</span>
    <span class="n">buoyancy_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">zb</span><span class="p">])</span>

    <span class="n">disp_volume</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">mass</span> <span class="o">/</span> <span class="n">rho_water</span>

    <span class="c1"># Computing quantities from intersection polygons</span>
    <span class="n">sigma0</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} dS = waterplane_area</span>
    <span class="n">sigma1</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} x dS</span>
    <span class="n">sigma2</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} y dS</span>
    <span class="n">sigma3</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} xy dS</span>
    <span class="n">sigma4</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} x^2 dS</span>
    <span class="n">sigma5</span> <span class="o">=</span> <span class="mf">0.</span>  <span class="c1"># \iint_{waterplane_area} y^2 dS</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">polygons</span> <span class="o">=</span> <span class="n">clipper</span><span class="o">.</span><span class="n">closed_polygons</span>
    <span class="k">for</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="n">polygons</span><span class="p">:</span>
        <span class="n">polyverts</span> <span class="o">=</span> <span class="n">clipper</span><span class="o">.</span><span class="n">clipped_crown_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">polygon</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">at_cog</span><span class="p">:</span>
            <span class="c1"># To get the stiffness expressed at cog</span>
            <span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">xb</span>
            <span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">yb</span>

        <span class="c1"># TODO: voir si on conserve ce test...</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The intersection polygon is not on the plane z=0&#39;</span><span class="p">)</span>

        <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">polyverts</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">xii</span><span class="p">,</span> <span class="n">yii</span><span class="p">)</span> <span class="ow">in</span> <span class="n">polyverts</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">xii</span> <span class="o">-</span> <span class="n">xi</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">yii</span> <span class="o">-</span> <span class="n">yi</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">+</span> <span class="n">xii</span>
            <span class="n">py</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">yii</span>

            <span class="n">sigma0</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">px</span>
            <span class="n">sigma1</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="p">(</span><span class="n">px</span> <span class="o">*</span> <span class="n">px</span> <span class="o">-</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">xii</span><span class="p">)</span>
            <span class="n">sigma2</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">py</span> <span class="o">*</span> <span class="n">py</span> <span class="o">-</span> <span class="n">yi</span> <span class="o">*</span> <span class="n">yii</span><span class="p">)</span>
            <span class="n">sigma3</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="p">(</span><span class="n">py</span> <span class="o">*</span> <span class="n">px</span> <span class="o">*</span> <span class="n">px</span> <span class="o">+</span> <span class="n">yi</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">+</span> <span class="n">yii</span> <span class="o">*</span> <span class="n">xii</span> <span class="o">*</span> <span class="n">xii</span><span class="p">)</span>
            <span class="n">sigma4</span> <span class="o">+=</span> <span class="n">dy</span> <span class="o">*</span> <span class="p">(</span><span class="n">xi</span> <span class="o">*</span> <span class="n">xi</span> <span class="o">+</span> <span class="n">xii</span> <span class="o">*</span> <span class="n">xii</span><span class="p">)</span> <span class="o">*</span> <span class="n">px</span>
            <span class="n">sigma5</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="p">(</span><span class="n">yi</span> <span class="o">*</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">yii</span> <span class="o">*</span> <span class="n">yii</span><span class="p">)</span> <span class="o">*</span> <span class="n">py</span>

            <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">xii</span><span class="p">,</span> <span class="n">yii</span>

        <span class="n">xmin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">xmax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">ymin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="n">ymax</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">polyverts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xmax</span><span class="p">)]</span>
    <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymax</span><span class="p">)]</span>

    <span class="n">sigma0</span> <span class="o">/=</span> <span class="mi">2</span>
    <span class="n">sigma1</span> <span class="o">/=</span> <span class="mi">6</span>
    <span class="n">sigma2</span> <span class="o">/=</span> <span class="o">-</span><span class="mi">6</span>
    <span class="n">sigma3</span> <span class="o">/=</span> <span class="mi">24</span>
    <span class="n">sigma4</span> <span class="o">/=</span> <span class="mi">12</span>
    <span class="n">sigma5</span> <span class="o">/=</span> <span class="o">-</span><span class="mi">12</span>

    <span class="c1"># Flotation surface</span>
    <span class="n">waterplane_area</span> <span class="o">=</span> <span class="n">sigma0</span>

    <span class="c1"># Stiffness matrix coefficients that do not depend on the position of the gravity center</span>
    <span class="n">rhog</span> <span class="o">=</span> <span class="n">rho_water</span> <span class="o">*</span> <span class="n">grav</span>
    <span class="n">s33</span> <span class="o">=</span> <span class="n">rhog</span> <span class="o">*</span> <span class="n">waterplane_area</span>
    <span class="n">s34</span> <span class="o">=</span> <span class="n">rhog</span> <span class="o">*</span> <span class="n">sigma2</span>
    <span class="n">s35</span> <span class="o">=</span> <span class="o">-</span><span class="n">rhog</span> <span class="o">*</span> <span class="n">sigma1</span>
    <span class="n">s45</span> <span class="o">=</span> <span class="o">-</span><span class="n">rhog</span> <span class="o">*</span> <span class="n">sigma3</span>

    <span class="c1"># Metacentric radius (Bouguer formulae)</span>
    <span class="n">transversal_metacentric_radius</span> <span class="o">=</span> <span class="n">sigma5</span> <span class="o">/</span> <span class="n">disp_volume</span>  <span class="c1"># Around Ox</span>
    <span class="n">longitudinal_metacentric_radius</span> <span class="o">=</span> <span class="n">sigma4</span> <span class="o">/</span> <span class="n">disp_volume</span>  <span class="c1"># Around Oy</span>

    <span class="c1"># Metacentric height</span>
    <span class="n">zcog</span> <span class="o">=</span> <span class="n">wcog</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">zcog</span> <span class="o">-</span> <span class="n">zb</span>  <span class="c1"># BG</span>
    <span class="n">transversal_metacentric_height</span> <span class="o">=</span> <span class="n">transversal_metacentric_radius</span> <span class="o">-</span> <span class="n">a</span>
    <span class="n">longitudinal_metacentric_height</span> <span class="o">=</span> <span class="n">longitudinal_metacentric_radius</span> <span class="o">-</span> <span class="n">a</span>

    <span class="c1"># Stiffness matrix coefficients that depend on the position of the gravity center</span>
    <span class="n">s44</span> <span class="o">=</span> <span class="n">rhog</span> <span class="o">*</span> <span class="n">disp_volume</span> <span class="o">*</span> <span class="n">transversal_metacentric_height</span>
    <span class="n">s55</span> <span class="o">=</span> <span class="n">rhog</span> <span class="o">*</span> <span class="n">disp_volume</span> <span class="o">*</span> <span class="n">longitudinal_metacentric_height</span>

    <span class="c1"># Assembling stiffness matrix</span>
    <span class="n">stiffness_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">s33</span><span class="p">,</span> <span class="n">s34</span><span class="p">,</span> <span class="n">s35</span><span class="p">],</span>
                                 <span class="p">[</span><span class="n">s34</span><span class="p">,</span> <span class="n">s44</span><span class="p">,</span> <span class="n">s45</span><span class="p">],</span>
                                 <span class="p">[</span><span class="n">s35</span><span class="p">,</span> <span class="n">s45</span><span class="p">,</span> <span class="n">s55</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Zeroing tiny coefficients</span>
    <span class="n">stiffness_matrix</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">stiffness_matrix</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-4</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Flotation center F:</span>
    <span class="n">x_f</span> <span class="o">=</span> <span class="o">-</span><span class="n">s35</span> <span class="o">/</span> <span class="n">s33</span>
    <span class="n">y_f</span> <span class="o">=</span> <span class="n">s34</span> <span class="o">/</span> <span class="n">s33</span>

    <span class="k">if</span> <span class="n">at_cog</span><span class="p">:</span>
        <span class="c1"># To get the flotation center expressed in the initial mesh frame</span>
        <span class="n">x_f</span> <span class="o">+=</span> <span class="n">xb</span>
        <span class="n">y_f</span> <span class="o">+=</span> <span class="n">yb</span>

    <span class="n">waterplane_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_f</span><span class="p">,</span> <span class="n">y_f</span><span class="p">,</span> <span class="o">-</span><span class="n">z_corr</span><span class="p">])</span>
    <span class="n">waterplane_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">),</span> <span class="n">waterplane_center</span><span class="p">)</span>

    <span class="c1"># Buoyancy center in the initial frame</span>
    <span class="n">buoyancy_center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">z_corr</span>
    <span class="n">buoyancy_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">),</span> <span class="n">buoyancy_center</span><span class="p">)</span>

    <span class="c1"># bounding box</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">cmesh</span><span class="o">.</span><span class="n">axis_aligned_bbox</span>

    <span class="c1"># Storing data</span>
    <span class="n">hs_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;grav&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grav</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;rho_water&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_water</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;mesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;rotmat_eq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotmat_corr</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;z_eq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">z_corr</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;cog&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;wet_surface_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wet_surface_area</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_volume</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_water</span> <span class="o">*</span> <span class="n">disp_volume</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;buoyancy_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">buoyancy_center</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;waterplane_center&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">waterplane_center</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;waterplane_area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">waterplane_area</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;transversal_metacentric_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transversal_metacentric_radius</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;longitudinal_metacentric_radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">longitudinal_metacentric_radius</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;transversal_metacentric_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transversal_metacentric_height</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;longitudinal_metacentric_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">longitudinal_metacentric_height</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stiffness_matrix</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_at_waterline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxx</span> <span class="o">-</span> <span class="n">minx</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth_at_waterline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_overall_submerged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth_overall_submerged&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;draught&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">zmin</span><span class="p">)</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;forward_perpendicular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxx</span> <span class="o">+</span> <span class="n">xb</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span>

    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;trust_lpp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">lpp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lpp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orig_at_ap</span><span class="p">:</span>
            <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;forward_perpendicular&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_at_waterline&#39;</span><span class="p">]</span>
            <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;trust_lpp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">inertia</span><span class="o">.</span><span class="n">set_cog</span><span class="p">(</span><span class="n">wcog</span><span class="p">)</span>
    <span class="n">inertia</span><span class="o">.</span><span class="n">shift_at_cog</span><span class="p">()</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Ixx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">xx</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Iyy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">yy</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Izz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">zz</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Ixy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">xy</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Ixz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">xz</span>
    <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Iyz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inertia</span><span class="o">.</span><span class="n">yz</span>

    <span class="k">return</span> <span class="n">hs_data</span></div>


<div class="viewcode-block" id="displacement_equilibrium"><a class="viewcode-back" href="../../api/meshmagick.hydrostatics.html#meshmagick.hydrostatics.displacement_equilibrium">[docs]</a><span class="k">def</span> <span class="nf">displacement_equilibrium</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">disp_tons</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">cog</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Displacement equilibrium&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target displacement:    </span><span class="si">{:.3f}</span><span class="s2"> tons&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disp_tons</span><span class="p">))</span>

    <span class="n">hs_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">disp_kg</span> <span class="o">=</span> <span class="n">disp_tons</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="n">itermax</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nb">iter</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">z_corr</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="c1"># Relaxation distance adapted to the size of the mesh</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">axis_aligned_bbox</span>
    <span class="n">z_relax</span> <span class="o">=</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">iter</span> <span class="o">==</span> <span class="n">itermax</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No convergence after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">itermax</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">hs_data</span> <span class="o">=</span> <span class="n">compute_hydrostatics</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">z_corr</span><span class="o">=</span><span class="n">z_corr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s1">&#39;below&#39;</span><span class="p">:</span>
                <span class="n">z_corr</span> <span class="o">=</span> <span class="o">-</span><span class="n">zmax</span> <span class="o">+</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-4</span>  <span class="c1"># FIXME: is this choice robust ?</span>
                <span class="n">hs_data</span> <span class="o">=</span> <span class="n">compute_hydrostatics</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">z_corr</span><span class="o">=</span><span class="n">z_corr</span><span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                    <span class="s2">&quot;Impossible to reach a displacement of </span><span class="si">%.3f</span><span class="s2"> tons because of the mesh extend. Limited to </span><span class="si">%.3f</span><span class="s2"> tons&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="n">disp_tons</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.001</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">z_corr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">err</span>

        <span class="n">disp_volume</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;disp_volume&quot;</span><span class="p">]</span>
        <span class="n">waterplane_area</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;waterplane_area&quot;</span><span class="p">]</span>

        <span class="n">mass_residual</span> <span class="o">=</span> <span class="n">rho_water</span> <span class="o">*</span> <span class="n">disp_volume</span> <span class="o">-</span> <span class="n">disp_kg</span>

        <span class="n">dz</span> <span class="o">=</span> <span class="n">mass_residual</span> <span class="o">/</span> <span class="p">(</span><span class="n">rho_water</span> <span class="o">*</span> <span class="n">waterplane_area</span><span class="p">)</span>

        <span class="c1"># Convergence criterion</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">mass_residual</span> <span class="o">/</span> <span class="n">disp_kg</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">reltol</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="c1"># Relaxation of the correction: z correction is bounded by z_relax to avoid divergence</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">dz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z_relax</span><span class="p">:</span>
            <span class="n">dz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">z_relax</span><span class="p">,</span> <span class="n">dz</span><span class="p">)</span>

        <span class="n">z_corr</span> <span class="o">+=</span> <span class="n">dz</span>

        <span class="nb">iter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Achieved displacement: </span><span class="si">{:.3f}</span><span class="s2"> tons (</span><span class="si">{:d}</span><span class="s2"> iterations)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;disp_mass&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">,</span> <span class="nb">iter</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">z_corr</span></div>


<div class="viewcode-block" id="full_equilibrium"><a class="viewcode-back" href="../../api/meshmagick.hydrostatics.html#meshmagick.hydrostatics.full_equilibrium">[docs]</a><span class="k">def</span> <span class="nf">full_equilibrium</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">disp_tons</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3DOF equilibrium&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;========================&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target diplacement:    </span><span class="si">{:.3f}</span><span class="s2"> tons&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">disp_tons</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;COG pos: &quot;</span><span class="p">,</span> <span class="n">cog</span><span class="p">)</span>

    <span class="n">disp_kg</span> <span class="o">=</span> <span class="n">disp_tons</span> <span class="o">*</span> <span class="mi">1000</span>

    <span class="n">rhog</span> <span class="o">=</span> <span class="n">rho_water</span> <span class="o">*</span> <span class="n">grav</span>
    <span class="n">mg</span> <span class="o">=</span> <span class="n">disp_kg</span> <span class="o">*</span> <span class="n">grav</span>

    <span class="n">wmesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Initial equilibrium in displacement</span>
    <span class="n">z_corr</span> <span class="o">=</span> <span class="n">displacement_equilibrium</span><span class="p">(</span><span class="n">wmesh</span><span class="p">,</span> <span class="n">disp_tons</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">reltol</span><span class="o">=</span><span class="n">reltol</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rotmat_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">hs_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">itermax</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nb">iter</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">iter</span> <span class="o">==</span> <span class="n">itermax</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No convergence after </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">itermax</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="n">wcog</span> <span class="o">=</span> <span class="n">cog</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">wcog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">,</span> <span class="n">wcog</span><span class="p">)</span>
        <span class="n">wcog</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">z_corr</span>

        <span class="c1"># Computing hydrostatics properties</span>
        <span class="n">hs_data</span> <span class="o">=</span> <span class="n">compute_hydrostatics</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cog</span><span class="p">,</span> <span class="n">rho_water</span><span class="p">,</span> <span class="n">grav</span><span class="p">,</span> <span class="n">rotmat_corr</span><span class="o">=</span><span class="n">rotmat_corr</span><span class="p">,</span> <span class="n">z_corr</span><span class="o">=</span><span class="n">z_corr</span><span class="p">)</span>

        <span class="c1"># Computing the residue</span>
        <span class="n">xg</span><span class="p">,</span> <span class="n">yg</span><span class="p">,</span> <span class="n">zg</span> <span class="o">=</span> <span class="n">wcog</span>
        <span class="n">buoyancy_center</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;buoyancy_center&quot;</span><span class="p">]</span>
        <span class="n">buoyancy_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rotmat_corr</span><span class="p">,</span> <span class="n">buoyancy_center</span><span class="p">)</span>
        <span class="n">buoyancy_center</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">z_corr</span>
        <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">zb</span> <span class="o">=</span> <span class="n">buoyancy_center</span>
        <span class="n">disp_volume</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_volume&#39;</span><span class="p">]</span>

        <span class="n">rhogv</span> <span class="o">=</span> <span class="n">rhog</span> <span class="o">*</span> <span class="n">disp_volume</span>
        <span class="n">residue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rhogv</span> <span class="o">-</span> <span class="n">mg</span><span class="p">,</span>
                            <span class="n">rhogv</span> <span class="o">*</span> <span class="n">yb</span> <span class="o">-</span> <span class="n">mg</span> <span class="o">*</span> <span class="n">yg</span><span class="p">,</span>
                            <span class="o">-</span><span class="n">rhogv</span> <span class="o">*</span> <span class="n">xb</span> <span class="o">+</span> <span class="n">mg</span> <span class="o">*</span> <span class="n">xg</span><span class="p">])</span>

        <span class="c1"># Computing scale for nondimensionalization</span>
        <span class="n">breadth</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth&#39;</span><span class="p">]</span>
        <span class="n">lwl</span> <span class="o">=</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_at_waterline&#39;</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mg</span><span class="p">,</span> <span class="n">mg</span> <span class="o">*</span> <span class="n">breadth</span><span class="p">,</span> <span class="n">mg</span> <span class="o">*</span> <span class="n">lwl</span><span class="p">])</span>

        <span class="c1"># Convergence criterion</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">residue</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">reltol</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&gt;&gt;&gt; Convergence reached in </span><span class="si">%u</span><span class="s2"> iterations&quot;</span> <span class="o">%</span> <span class="nb">iter</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="c1"># Solving for the next incremental correction</span>
        <span class="n">tz</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;stiffness_matrix&quot;</span><span class="p">],</span> <span class="n">residue</span><span class="p">)</span>

        <span class="c1"># Relaxation</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="n">wmesh</span><span class="o">.</span><span class="n">axis_aligned_bbox</span>
        <span class="n">z_relax</span> <span class="o">=</span> <span class="p">(</span><span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">tz</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">z_relax</span><span class="p">:</span>
            <span class="n">tz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">z_relax</span><span class="p">,</span> <span class="n">tz</span><span class="p">)</span>

        <span class="n">rx_relax</span> <span class="o">=</span> <span class="n">ry_relax</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">rx_relax</span><span class="p">:</span>
            <span class="n">rx</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">rx_relax</span><span class="p">,</span> <span class="n">rx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">ry</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">ry_relax</span><span class="p">:</span>
            <span class="n">ry</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="n">ry_relax</span><span class="p">,</span> <span class="n">ry</span><span class="p">)</span>

        <span class="n">rotmat_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">cardan_to_rotmat</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">rotmat_corr</span><span class="p">)</span>  <span class="c1"># fonctionne !</span>
        <span class="n">z_corr</span> <span class="o">+=</span> <span class="n">tz</span>

        <span class="nb">iter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">z_corr</span><span class="p">,</span> <span class="n">rotmat_corr</span></div>


<div class="viewcode-block" id="get_hydrostatic_report"><a class="viewcode-back" href="../../api/meshmagick.hydrostatics.html#meshmagick.hydrostatics.get_hydrostatic_report">[docs]</a><span class="k">def</span> <span class="nf">get_hydrostatic_report</span><span class="p">(</span><span class="n">hs_data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a hydrostatic report for the current configuration</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">hspace</span><span class="p">():</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="k">def</span> <span class="nf">build_line</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">):</span>
        <span class="c1"># TODO: ajouter unit</span>
        <span class="n">textwidth</span> <span class="o">=</span> <span class="mi">45</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{:-&lt;</span><span class="si">{textwidth}</span><span class="s1">}&gt;  {:&lt; .</span><span class="si">{precision}{dtype}</span><span class="s1">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">data</span><span class="p">,</span>
                                                                            <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
                                                                            <span class="n">textwidth</span><span class="o">=</span><span class="n">textwidth</span><span class="p">,</span>
                                                                            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
                                                                            <span class="p">)</span>
        <span class="c1"># ValueError for Python 2</span>
        <span class="c1"># TypeError for Python 3</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;{:&lt; 10.</span><span class="si">{precision}{dtype}</span><span class="s1">}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">{:-&lt;</span><span class="si">{textwidth}</span><span class="s1">}&gt;  </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">data_str</span><span class="p">,</span> <span class="n">textwidth</span><span class="o">=</span><span class="n">textwidth</span><span class="p">)</span>

                    <span class="c1"># else:</span>
                    <span class="c1">#     print data</span>

        <span class="k">return</span> <span class="n">line</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;HYDROSTATIC REPORT (Meshmagick version </span><span class="si">%s</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">version</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;[1]</span><span class="se">\t</span><span class="s1">Corrections made on initial mesh:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Z correction (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;z_eq&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">heel</span><span class="p">,</span> <span class="n">trim</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">rotmat_to_cardan</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;rotmat_eq&#39;</span><span class="p">])</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Heel correction (deg)&#39;</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">heel</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Trim correction (deg)&#39;</span><span class="p">,</span> <span class="n">degrees</span><span class="p">(</span><span class="n">trim</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Gravity acceleration (M/S**2)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;grav&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Density of water (kg/M**3)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;rho_water&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Waterplane area (M**2)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;waterplane_area&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Waterplane center (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;waterplane_center&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Wetted Surface Area (M**2)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;wet_surface_area&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Displacement volume (M**3)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_volume&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Displacement mass (tons)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Buoyancy center (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s2">&quot;buoyancy_center&quot;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Center of gravity (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;cog&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Draft (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;draught&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># TODO</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Length overall submerged (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_overall_submerged&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Breadth overall submerged (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth_overall_submerged&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Length at Waterline LWL (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_at_waterline&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Forward perpendicular FP (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;forward_perpendicular&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;trust_lpp&#39;</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Length between perpendiculars Lpp (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">],</span>
                          <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;[2] Length between perpendiculars Lpp (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">],</span>
                          <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Transversal metacentric radius (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;transversal_metacentric_radius&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Longitudinal metacentric radius (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;longitudinal_metacentric_radius&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Transversal metacentric height GMt (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;transversal_metacentric_height&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Longitudinal metacentric height GMl (M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;longitudinal_metacentric_height&#39;</span><span class="p">],</span>
                      <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;transversal_metacentric_height&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt;  TRANSVERSALLY UNSTABLE  &gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;longitudinal_metacentric_height&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&lt;&lt;&lt;  LONGITUDINALLY UNSTABLE  &gt;&gt;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">HYDROSTATIC STIFFNESS COEFFICIENTS (at COG horiz. Pos.):</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K33 (N/M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K34 (N)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K35 (N)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K44 (N.M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K45 (N.M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;K55 (N.M)&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;stiffness_matrix&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;trust_lpp&#39;</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">INERTIAS from standard approximations: [Rxx = 0.3 B; Ryy = Rzz = 0.25 Lpp]</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;[2]</span><span class="se">\t</span><span class="s1">INERTIAS from standard approximations: [Rxx = 0.3 B; Ryy = Rzz = 0.25 Lpp]</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="n">Rxx</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;breadth_overall_submerged&#39;</span><span class="p">]</span>
    <span class="n">Ryy_zz</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;length_between_perpendiculars&#39;</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Rxx (M)&#39;</span><span class="p">,</span> <span class="n">Rxx</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Ryy (M)&#39;</span><span class="p">,</span> <span class="n">Ryy_zz</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Rzz (M)&#39;</span><span class="p">,</span> <span class="n">Ryy_zz</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Ixx&#39;</span><span class="p">,</span> <span class="n">Rxx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Iyy&#39;</span><span class="p">,</span> <span class="n">Ryy_zz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Izz&#39;</span><span class="p">,</span> <span class="n">Ryy_zz</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">INERTIAS from homogeneous immersed hull approximation:</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Rxx&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Ixx&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Ryy&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Iyy&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Rzz&#39;</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Izz&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;disp_mass&#39;</span><span class="p">]),</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Ixx&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Ixx&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Iyy&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Iyy&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">build_line</span><span class="p">(</span><span class="s1">&#39;Izz&#39;</span><span class="p">,</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;Izz&#39;</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>

    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="n">hspace</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;NOTES</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;=====</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;[1] To get computed hydrostatic equilibrium position from initial mesh, corrections must be </span><span class="se">\n</span><span class="s2">&quot;</span> \
           <span class="s2">&quot;    applied in the following order:</span><span class="se">\n</span><span class="s2">&quot;</span> \
           <span class="s2">&quot;    </span><span class="se">\t</span><span class="s2">* First rotations around initial X &amp; Y axes w.r.t initial frame origin</span><span class="se">\n</span><span class="s2">&quot;</span> \
           <span class="s2">&quot;    </span><span class="se">\t</span><span class="s2">* Second Z translation along initial Z-axis (not the one obtained after the rotations)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hs_data</span><span class="p">[</span><span class="s1">&#39;trust_lpp&#39;</span><span class="p">]:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;[2] Not enough information to get a trusted Lpp. It has been approximated by Lwl instead.</span><span class="se">\n</span><span class="s2">&quot;</span> \
               <span class="s2">&quot;    It has an influence on the Iyy and Izz inertias calculated from standard approximations.</span><span class="se">\n</span><span class="s2">&quot;</span> \
               <span class="s2">&quot;    To get more accurate results, please specify a Lpp.&quot;</span>

    <span class="k">return</span> <span class="n">msg</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Ecole Centrale de Nantes
      <span class="lastupdated">
        Last updated on Oct 19, 2021.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>